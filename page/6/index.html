<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>蓝湖畔淅淅沥沥的雨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="蓝湖畔淅淅沥沥的雨">
<meta property="og:url" content="http://example.com/page/6/index.html">
<meta property="og:site_name" content="蓝湖畔淅淅沥沥的雨">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="StarsWhisper">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="蓝湖畔淅淅沥沥的雨" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/plugin/bganimation/bg.css">

  

  <link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" rel="stylesheet" type="text/css">
<meta name="generator" content="Hexo 6.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/images/avatar.png">
    <h2 class="author">StarsWhisper</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>79</strong><br>文章</div></a>
      <a href="/categories"><div><strong>32</strong><br>分类</div></a>
      <a href="/tags"><div><strong>63</strong><br>标签</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
          <a href="/bridges" title="Bridges">
            <li>传送门</li>
          </a>
        
          <a href="/knightabout" title="About">
            <li>关于</li>
          </a>
        
          <a href="/announcement" title="Announcement">
            <li>公告</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main">
  
    <article id="post-【机器学习】 应用简例 随机森林 交叉验证 网格化搜索" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/1111/11/11/%E3%80%90%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E3%80%91%20%E5%BA%94%E7%94%A8%E7%AE%80%E4%BE%8B%20%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%20%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81%20%E7%BD%91%E6%A0%BC%E5%8C%96%E6%90%9C%E7%B4%A2/" class="article-date">
  <time class="post-time" datetime="1111-11-11T03:06:11.000Z" itemprop="datePublished">
    <span class="post-month">11月</span><br/>
    <span class="post-day">11</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/1111/11/11/%E3%80%90%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E3%80%91%20%E5%BA%94%E7%94%A8%E7%AE%80%E4%BE%8B%20%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%20%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81%20%E7%BD%91%E6%A0%BC%E5%8C%96%E6%90%9C%E7%B4%A2/">【机器学习】 应用简例 随机森林 交叉验证 网格化搜索.md</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%99%E7%BB%83%E6%88%91%E6%83%B3%E5%AD%A6%E6%8C%82%E8%BE%B9%E8%BA%B2%E7%89%9B/">教练我想学挂边躲牛</a>,<a class="article-category-link" href="/categories/%E6%95%99%E7%BB%83%E6%88%91%E6%83%B3%E5%AD%A6%E6%8C%82%E8%BE%B9%E8%BA%B2%E7%89%9B/%E7%9E%8E%E5%AD%A6%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">瞎学机器学习</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="说明-2022-05-05"><a class="markdownIt-Anchor" href="#说明-2022-05-05"></a> 说明 - 2022-05-05</h2>
<p>本篇博客为本人原创, 原发布于CSDN, 在搭建个人博客后使用爬虫批量爬取并挂到个人博客, 出于一些技术原因博客未能完全还原到初始版本(而且我懒得修改), 在观看体验上会有一些瑕疵 ,若有需求会发布重制版总结性新博客。发布时间统一定为1111年11月11日。钦此。</p>
<pre><code>%matplotlib inline
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
from sklearn.model_selection import GridSearchCV
from sklearn.model_selection import cross_val_score
from sklearn.model_selection import GridSearchCV
</code></pre>
<p>导入数据</p>
<p>​<br>
# 从excel表导入数据<br>
df_t = pd.read_excel(r’D:\EdgeDownloadPlace\3dd40612152202ee8440f82a3d277008\train.xlsx’)</p>
<pre><code># 删除uid列
df_t = df_t.drop(columns='uid')

# 把数据中的'?'换成每一列的众数
for col in df_t.columns:
    idx = df_t[col].value_counts().index
    df_t[col][df_t[col] == '?'] = idx[0] if idx[0] != '?' else idx[1]

# 把pandas.DataFrame数据转化为numpy.darray数据 元素类型为np.float32
arr_t = df_t.values.astype(np.float32)
</code></pre>
<p>交叉验证找分数最高的n_estimators</p>
<p>​<br>
score_tt = []<br>
for i in range(0,300,15):<br>
rfc = RandomForestClassifier(n_estimators = i+1<br>
,n_jobs = -1<br>
,random_state = 156535<br>
)<br>
score = cross_val_score(rfc, arr_t[:,:-1],arr_t[:,-1],cv=10).mean()<br>
score_tt.append(score)<br>
peak = [max(score_tt), score_tt.index(max(score_tt))*15+1]<br>
plt.figure(figsize = [20,5])<br>
plt.plot(range(1,301,15),score_tt)<br>
plt.show()<br>
peak</p>
<p>![在这里插入图片描述](<a target="_blank" rel="noopener" href="https://img-blog.csdnimg.cn/20201031121122721.PNG?x-oss-">https://img-blog.csdnimg.cn/20201031121122721.PNG?x-oss-</a><br>
process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dsZGNtenk=,size_16,color_FFFFFF,t_70#pic_center)</p>
<p>​<br>
score_tt = []<br>
for i in range(peak[1]-15,peak[1]+15):<br>
rfc = RandomForestClassifier(n_estimators = i+1<br>
,n_jobs = -1<br>
,random_state = 156535)<br>
score = cross_val_score(rfc, arr_t[:,:-1],arr_t[:,-1],cv=10).mean()<br>
score_tt.append(score)<br>
peak = [max(score_tt), ([*range(peak[1]-15,peak[1]+15)][score_tt.index(max(score_tt))])]<br>
plt.figure(figsize = [20,5])<br>
plt.plot(range(peak[1]-15,peak[1]+15),score_tt)<br>
plt.show()<br>
peak</p>
<p>![在这里插入图片描述](<a target="_blank" rel="noopener" href="https://img-blog.csdnimg.cn/20201031121129915.PNG?x-oss-">https://img-blog.csdnimg.cn/20201031121129915.PNG?x-oss-</a><br>
process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dsZGNtenk=,size_16,color_FFFFFF,t_70#pic_center)</p>
<p>​<br>
n_peak = peak[1]</p>
<p>网格化搜索找最大深度</p>
<p>​<br>
param_grid = {‘max_depth’ : np.arange(1,14)}</p>
<pre><code>rfc =  rfc = RandomForestClassifier(n_estimators = n_peak
                                ,random_state = 156535
                                   ) 
GS = GridSearchCV(rfc,param_grid,cv=10)
GS.fit(arr_t[:,:-1],arr_t[:,-1])

#GS.best_params_ #返回最佳参数

#GS.best_score_ #返回最佳参数对应的准确率

[GS.best_score_, GS.best_params_]
</code></pre>
<p>​<br>
​<br>
depth_peak=GS.best_params_[‘max_depth’]</p>
<p>同理min_samples_split</p>
<p>​<br>
param_grid = {‘min_samples_split’ : np.arange(2,30)}</p>
<pre><code>rfc =  rfc = RandomForestClassifier(n_estimators = n_peak
                                ,random_state = 156535
                                ,max_depth = depth_peak
                                   )
GS = GridSearchCV(rfc,param_grid,cv=10)
GS.fit(arr_t[:,:-1],arr_t[:,-1])

#GS.best_params_ #返回最佳参数

#GS.best_score_ #返回最佳参数对应的准确率

[GS.best_score_, GS.best_params_]
</code></pre>
<p>同理 criterion</p>
<p>​<br>
param_grid = {‘criterion’ : [‘gini’,‘entropy’]}</p>
<pre><code>rfc =  rfc = RandomForestClassifier(n_estimators = n_peak
                                ,random_state = 156535
                                ,max_depth = depth_peak
                                   )
GS = GridSearchCV(rfc,param_grid,cv=10)
GS.fit(arr_t[:,:-1],arr_t[:,-1])

#GS.best_params_ #返回最佳参数

#GS.best_score_ #返回最佳参数对应的准确率

[GS.best_score_, GS.best_params_]
</code></pre>
<p>网格化搜索n_estimators</p>
<p>​<br>
param_grid = {‘n_estimators’ : np.arange(1,300,15)}</p>
<pre><code>rfc = RandomForestClassifier( random_state = 156535
                               
                                   )
GS = GridSearchCV(rfc,param_grid,cv=10)
GS.fit(arr_t[:,:-1],arr_t[:,-1])

#GS.best_params_ #返回最佳参数

#GS.best_score_ #返回最佳参数对应的准确率

[GS.best_score_, GS.best_params_]
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/1111/11/11/%E3%80%90%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E3%80%91%20%E5%BA%94%E7%94%A8%E7%AE%80%E4%BE%8B%20%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%20%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81%20%E7%BD%91%E6%A0%BC%E5%8C%96%E6%90%9C%E7%B4%A2/" data-id="cl50x8cn7003bccj36moa52yq" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OldBlog-Before20220505/" rel="tag">OldBlog(Before20220505)</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97/" rel="tag">随机森林</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-【机器学习】应用简例 使用sklearn交叉验证随机森林" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/1111/11/11/%E3%80%90%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E3%80%91%E5%BA%94%E7%94%A8%E7%AE%80%E4%BE%8B%20%E4%BD%BF%E7%94%A8sklearn%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97/" class="article-date">
  <time class="post-time" datetime="1111-11-11T03:06:11.000Z" itemprop="datePublished">
    <span class="post-month">11月</span><br/>
    <span class="post-day">11</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/1111/11/11/%E3%80%90%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E3%80%91%E5%BA%94%E7%94%A8%E7%AE%80%E4%BE%8B%20%E4%BD%BF%E7%94%A8sklearn%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97/">【机器学习】应用简例 使用sklearn交叉验证随机森林.md</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%99%E7%BB%83%E6%88%91%E6%83%B3%E5%AD%A6%E6%8C%82%E8%BE%B9%E8%BA%B2%E7%89%9B/">教练我想学挂边躲牛</a>,<a class="article-category-link" href="/categories/%E6%95%99%E7%BB%83%E6%88%91%E6%83%B3%E5%AD%A6%E6%8C%82%E8%BE%B9%E8%BA%B2%E7%89%9B/%E7%9E%8E%E5%AD%A6%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">瞎学机器学习</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="说明-2022-05-05"><a class="markdownIt-Anchor" href="#说明-2022-05-05"></a> 说明 - 2022-05-05</h2>
<p>本篇博客为本人原创, 原发布于CSDN, 在搭建个人博客后使用爬虫批量爬取并挂到个人博客, 出于一些技术原因博客未能完全还原到初始版本(而且我懒得修改), 在观看体验上会有一些瑕疵 ,若有需求会发布重制版总结性新博客。发布时间统一定为1111年11月11日。钦此。</p>
<p>从excel中导入训练集+交叉验证随机森林</p>
<p>​<br>
import numpy as np<br>
import pandas as pd<br>
from sklearn.ensemble import RandomForestClassifier<br>
from sklearn.model_selection import cross_val_score<br>
import matplotlib.pyplot as plt</p>
<pre><code># 从excel表导入数据
df_t = pd.read_excel(r'D:\EdgeDownloadPlace\3dd40612152202ee8440f82a3d277008\train.xlsx')

# 删除uid列
df_t = df_t.drop(columns='uid')

# 把数据中的'?'换成每一列的众数
for col in df_t.columns:
    idx = df_t[col].value_counts().index
    df_t[col][df_t[col] == '?'] = idx[0] if idx[0] != '?' else idx[1]

# 把pandas.DataFrame数据转化为numpy.darray数据 元素类型为np.float32
arr_t = df_t.values.astype(np.float32)

# 获得100次交叉验证的总体成绩 这100次验证决策树的个数为1-100
scores = []
for i in range(100):
    rfc = RandomForestClassifier(n_estimators = i+10, n_jobs = -1)
    rfc_s = cross_val_score(rfc,arr_t[:,:-1],arr_t[:,-1],cv=10).mean()
    scores.append(rfc_s)

# 画出来
plt.plot(range(1,101),scores,label = 'RandomForest')
plt.show()
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/1111/11/11/%E3%80%90%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E3%80%91%E5%BA%94%E7%94%A8%E7%AE%80%E4%BE%8B%20%E4%BD%BF%E7%94%A8sklearn%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97/" data-id="cl50x8cn8003eccj3giknhyli" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OldBlog-Before20220505/" rel="tag">OldBlog(Before20220505)</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97/" rel="tag">随机森林</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-【机器学习】应用简例 决策树 并用graphviz可视化树" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/1111/11/11/%E3%80%90%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E3%80%91%E5%BA%94%E7%94%A8%E7%AE%80%E4%BE%8B%20%E5%86%B3%E7%AD%96%E6%A0%91%20%E5%B9%B6%E7%94%A8graphviz%E5%8F%AF%E8%A7%86%E5%8C%96%E6%A0%91/" class="article-date">
  <time class="post-time" datetime="1111-11-11T03:06:11.000Z" itemprop="datePublished">
    <span class="post-month">11月</span><br/>
    <span class="post-day">11</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/1111/11/11/%E3%80%90%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E3%80%91%E5%BA%94%E7%94%A8%E7%AE%80%E4%BE%8B%20%E5%86%B3%E7%AD%96%E6%A0%91%20%E5%B9%B6%E7%94%A8graphviz%E5%8F%AF%E8%A7%86%E5%8C%96%E6%A0%91/">【机器学习】应用简例 决策树 并用graphviz可视化树.md</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%99%E7%BB%83%E6%88%91%E6%83%B3%E5%AD%A6%E6%8C%82%E8%BE%B9%E8%BA%B2%E7%89%9B/">教练我想学挂边躲牛</a>,<a class="article-category-link" href="/categories/%E6%95%99%E7%BB%83%E6%88%91%E6%83%B3%E5%AD%A6%E6%8C%82%E8%BE%B9%E8%BA%B2%E7%89%9B/%E7%9E%8E%E5%AD%A6%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">瞎学机器学习</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="说明-2022-05-05"><a class="markdownIt-Anchor" href="#说明-2022-05-05"></a> 说明 - 2022-05-05</h2>
<p>本篇博客为本人原创, 原发布于CSDN, 在搭建个人博客后使用爬虫批量爬取并挂到个人博客, 出于一些技术原因博客未能完全还原到初始版本(而且我懒得修改), 在观看体验上会有一些瑕疵 ,若有需求会发布重制版总结性新博客。发布时间统一定为1111年11月11日。钦此。</p>
<p>导入库</p>
<p>​<br>
import pandas as pd<br>
import numpy as np<br>
from sklearn import tree<br>
from sklearn.model_selection import train_test_split</p>
<p>导入数据</p>
<p>​<br>
df_t=pd.read_excel(r’D:\EdgeDownloadPlace\3dd40612152202ee8440f82a3d277008\train.xlsx’)<br>
df_t=df_t.drop(columns=‘uid’)<br>
df_t</p>
<p>![df_t](<a target="_blank" rel="noopener" href="https://img-blog.csdnimg.cn/20201028221351794.png?x-oss-">https://img-blog.csdnimg.cn/20201028221351794.png?x-oss-</a><br>
process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dsZGNtenk=,size_16,color_FFFFFF,t_70#pic_center)<br>
用众数替换问号</p>
<p>​<br>
for col in df_t.columns:<br>
df_t[col][df_t[col] == ‘?’] = df_t[col].value_counts().index[0] if df_t[col].value_counts().index[0] != ‘?’ else df_t[col].value_counts().index[1]<br>
df_t</p>
<p>![df_t2](<a target="_blank" rel="noopener" href="https://img-blog.csdnimg.cn/20201028221513308.png?x-oss-">https://img-blog.csdnimg.cn/20201028221513308.png?x-oss-</a><br>
process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dsZGNtenk=,size_16,color_FFFFFF,t_70#pic_center)<br>
得到float类型矩阵</p>
<p>​<br>
arr_t=df_t.values.astype(np.float32)<br>
arr_t</p>
<blockquote>
<p>array([[61., 0., 2., …, 0., 7., 0.],<br>
[64., 1., 3., …, 0., 7., 1.],<br>
[40., 0., 4., …, 0., 6., 1.],<br>
…,<br>
[65., 0., 3., …, 1., 3., 0.],<br>
[63., 1., 4., …, 0., 7., 0.],<br>
[55., 0., 4., …, 1., 7., 1.]], dtype=float32)<br>
把训练集分成测试集训练集(倒入的全是训练集)</p>
</blockquote>
<pre><code>Xtrain,Xtest,Ytrain,Ytest = train_test_split(arr_t[:,:-1],arr_t[:,-1],test_size=0.3)
</code></pre>
<p>实例化决策树，训练模型，查看正确率</p>
<p>​<br>
dtc = tree.DecisionTreeClassifier(criterion=“entropy”<br>
,max_depth=4<br>
,min_samples_split=10).fit(Xtrain,Ytrain)<br>
score = dtc.score(Xtest,Ytest)<br>
score</p>
<blockquote>
<p>0.8140703517587939</p>
</blockquote>
<p>画图</p>
<p>​<br>
graph_tree = graphviz.Source(tree.export_graphviz(dtc<br>
,feature_names = df_t.keys()[:-1]<br>
,class_names = [‘患病’,‘不患病’]<br>
,filled = True<br>
,rounded = True))<br>
graph_tree</p>
<p>![graph_tree](<a target="_blank" rel="noopener" href="https://img-blog.csdnimg.cn/20201028221815494.png?x-oss-">https://img-blog.csdnimg.cn/20201028221815494.png?x-oss-</a><br>
process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dsZGNtenk=,size_16,color_FFFFFF,t_70#pic_center)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/1111/11/11/%E3%80%90%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E3%80%91%E5%BA%94%E7%94%A8%E7%AE%80%E4%BE%8B%20%E5%86%B3%E7%AD%96%E6%A0%91%20%E5%B9%B6%E7%94%A8graphviz%E5%8F%AF%E8%A7%86%E5%8C%96%E6%A0%91/" data-id="cl50x8cn9003iccj30syu65mk" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OldBlog-Before20220505/" rel="tag">OldBlog(Before20220505)</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%86%B3%E7%AD%96%E6%A0%91/" rel="tag">决策树</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-【机器学习】应用简例 随机森林 使用袋外数据（袋装法） + RandomForestClassifier的一些常用方法" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/1111/11/11/%E3%80%90%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E3%80%91%E5%BA%94%E7%94%A8%E7%AE%80%E4%BE%8B%20%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%20%E4%BD%BF%E7%94%A8%E8%A2%8B%E5%A4%96%E6%95%B0%E6%8D%AE%EF%BC%88%E8%A2%8B%E8%A3%85%E6%B3%95%EF%BC%89%20+%20RandomForestClassifier%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/" class="article-date">
  <time class="post-time" datetime="1111-11-11T03:06:11.000Z" itemprop="datePublished">
    <span class="post-month">11月</span><br/>
    <span class="post-day">11</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/1111/11/11/%E3%80%90%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E3%80%91%E5%BA%94%E7%94%A8%E7%AE%80%E4%BE%8B%20%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%20%E4%BD%BF%E7%94%A8%E8%A2%8B%E5%A4%96%E6%95%B0%E6%8D%AE%EF%BC%88%E8%A2%8B%E8%A3%85%E6%B3%95%EF%BC%89%20+%20RandomForestClassifier%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/">【机器学习】应用简例 随机森林 使用袋外数据（袋装法） + RandomForestClassifier的一些常用方法.md</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%99%E7%BB%83%E6%88%91%E6%83%B3%E5%AD%A6%E6%8C%82%E8%BE%B9%E8%BA%B2%E7%89%9B/">教练我想学挂边躲牛</a>,<a class="article-category-link" href="/categories/%E6%95%99%E7%BB%83%E6%88%91%E6%83%B3%E5%AD%A6%E6%8C%82%E8%BE%B9%E8%BA%B2%E7%89%9B/%E7%9E%8E%E5%AD%A6%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">瞎学机器学习</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="说明-2022-05-05"><a class="markdownIt-Anchor" href="#说明-2022-05-05"></a> 说明 - 2022-05-05</h2>
<p>本篇博客为本人原创, 原发布于CSDN, 在搭建个人博客后使用爬虫批量爬取并挂到个人博客, 出于一些技术原因博客未能完全还原到初始版本(而且我懒得修改), 在观看体验上会有一些瑕疵 ,若有需求会发布重制版总结性新博客。发布时间统一定为1111年11月11日。钦此。</p>
<pre><code>import numpy as np
import pandas as pd
from sklearn.ensemble import RandomForestClassifier

# 从excel表导入数据
df_t = pd.read_excel(r'D:\EdgeDownloadPlace\3dd40612152202ee8440f82a3d277008\train.xlsx')

# 删除uid列
df_t = df_t.drop(columns='uid')

# 把数据中的'?'换成每一列的众数
for col in df_t.columns:
    idx = df_t[col].value_counts().index
    df_t[col][df_t[col] == '?'] = idx[0] if idx[0] != '?' else idx[1]

# 把pandas.DataFrame数据转化为numpy.darray数据 元素类型为np.float32
arr_t = df_t.values.astype(np.float32)
</code></pre>
<p>​<br>
​<br>
rfc = RandomForestClassifier(bootstrap=True #boostrap默认为True 即使用装袋法<br>
,oob_score=True #oob_score默认为False 为True即使用袋外数据做测试集，训练模型时不需要划分训练集和测试集#<br>
,max_depth=4<br>
)<br>
rfc = rfc.fit(arr_t[:,:-1],arr_t[:,-1])</p>
<pre><code>print(rfc.oob_score_) #打印成绩
</code></pre>
<p>​<br>
print(rfc.estimators_) #打印所有的树</p>
<pre><code>print(rfc.feature_importances_) #打印特征的重要性

Xtrain,Xtest,Ytrain,Ytest = train_test_split(arr_t[:,:-1],arr_t[:,-1],test_size=0.3)

rfc = RandomForestClassifier(max_depth=4).fit(Xtrain,Ytrain)

print(rfc.apply(Xtest)) #返回测试集中 每一个样本 在每一颗树中的叶子节点的索引

print(rfc.predict(Xtest)) #返回模型预测的测试集的结果

print(rfc.predict_proba(Xtest)) #返回每一个样本被分到每一个标签的概率
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/1111/11/11/%E3%80%90%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E3%80%91%E5%BA%94%E7%94%A8%E7%AE%80%E4%BE%8B%20%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%20%E4%BD%BF%E7%94%A8%E8%A2%8B%E5%A4%96%E6%95%B0%E6%8D%AE%EF%BC%88%E8%A2%8B%E8%A3%85%E6%B3%95%EF%BC%89%20+%20RandomForestClassifier%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/" data-id="cl50x8cn9003kccj38xj0f79p" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OldBlog-Before20220505/" rel="tag">OldBlog(Before20220505)</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97/" rel="tag">随机森林</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-【机器学习】应用简例 随机森林-小白无脑乱用" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/1111/11/11/%E3%80%90%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E3%80%91%E5%BA%94%E7%94%A8%E7%AE%80%E4%BE%8B%20%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97-%E5%B0%8F%E7%99%BD%E6%97%A0%E8%84%91%E4%B9%B1%E7%94%A8/" class="article-date">
  <time class="post-time" datetime="1111-11-11T03:06:11.000Z" itemprop="datePublished">
    <span class="post-month">11月</span><br/>
    <span class="post-day">11</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/1111/11/11/%E3%80%90%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E3%80%91%E5%BA%94%E7%94%A8%E7%AE%80%E4%BE%8B%20%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97-%E5%B0%8F%E7%99%BD%E6%97%A0%E8%84%91%E4%B9%B1%E7%94%A8/">【机器学习】应用简例 随机森林-小白无脑乱用.md</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%99%E7%BB%83%E6%88%91%E6%83%B3%E5%AD%A6%E6%8C%82%E8%BE%B9%E8%BA%B2%E7%89%9B/">教练我想学挂边躲牛</a>,<a class="article-category-link" href="/categories/%E6%95%99%E7%BB%83%E6%88%91%E6%83%B3%E5%AD%A6%E6%8C%82%E8%BE%B9%E8%BA%B2%E7%89%9B/%E7%9E%8E%E5%AD%A6%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">瞎学机器学习</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="说明-2022-05-05"><a class="markdownIt-Anchor" href="#说明-2022-05-05"></a> 说明 - 2022-05-05</h2>
<p>本篇博客为本人原创, 原发布于CSDN, 在搭建个人博客后使用爬虫批量爬取并挂到个人博客, 出于一些技术原因博客未能完全还原到初始版本(而且我懒得修改), 在观看体验上会有一些瑕疵 ,若有需求会发布重制版总结性新博客。发布时间统一定为1111年11月11日。钦此。</p>
<p>发现随机森林的正确率在0.76-0.86左右，多次用随机森林找一个正确率大于0.84的模型输出答案</p>
<p>这次用到的参数：<br>
rfc=RandomForestClassifier(n_estimators=100 #决策树的数量<br>
,criterion=“entropy” #分类标准-信息熵or基尼系数<br>
,max_depth=4 #决策树最大深度<br>
,min_samples_split=10) #至少有10个数据，树才会继续分支<br>
。</p>
<p>把训练集分为新训练集和新问题集，在这上面验证准确性<br>
Xtrain, Xtest, Ytrain, Ytest =<br>
train_test_split(arr_t[:,:-1],arr_t[:,-1],test_size=0.3)<br>
#（数据集，答案集，如何划分）0.3表示训练集和问题集三七分</p>
<p>​<br>
import numpy as np<br>
import pandas as pd<br>
from sklearn.ensemble import RandomForestClassifier<br>
#随机森林分类器<br>
from sklearn.model_selection import train_test_split<br>
#功能：将数据集分为训练集测试集 Xtrain,Xtest,Ytrain,Ytest</p>
<pre><code>df_t=pd.read_excel(r'D:\EdgeDownloadPlace\3dd40612152202ee8440f82a3d277008\train.xlsx')
df_a=pd.read_excel(r'D:\EdgeDownloadPlace\3dd40612152202ee8440f82a3d277008\test.xlsx')

def get_data_array_float64(df,test=False):
    df = df.drop(columns='uid')
    #去列名对应的列
    if test == True:
        df=df.drop(columns ='target')
        #去列名对应的列
        
    col_mode_lst=[]
    for each_col in df.columns:#获得每一列的众数
        cnts = df[each_col].value_counts()
   		#得到每一列的所有值以及它们出现的次数 ，降序排列
        if '?' in cnts and cnts.index[0] == '?':
            idx=1
        else :
            idx=0
        col_mode_lst.append(cnts.index[idx])

    for i in range(len(df.columns)):
        df[df.columns[i]][df[df.columns[i]] == '?'] = col_mode_lst[i]
        #df[df.columns[i]]按照列名获得列
		#按照列名获得列，找到列中值为‘？’的元素，将其改成col_mode_lst[i]
		
    df_array = df.values.astype(np.float64)
    #df.values得到DataFrame对象的矩阵形式
    #,astype()方法为矩阵转化元素类型
    return df_array

arr_t=get_data_array_float64(df_t)
arr_a=get_data_array_float64(df_a,True)
</code></pre>
<p>​<br>
Xtrain, Xtest, Ytrain, Ytest = train_test_split(arr_t[:,:-1],arr_t[:,-1],test_size=0.3)</p>
<pre><code>while True:
    rfc=RandomForestClassifier(n_estimators=100
                                ,criterion=&quot;entropy&quot;
                               ,max_depth=4
                               ,min_samples_split=10)
                           		#实例化随机森林
    rfc = rfc.fit(Xtrain,Ytrain)
    #训练模型
    score = rfc.score(Xtest,Ytest)
    #得到正确率
    if score&gt;0.84:
        answer = rfc.predict(arr_a).astype(np.int8).tolist()
        break

answer_df=pd.DataFrame(answer)
answer_df.to_excel(r'D:\EdgeDownloadPlace\3dd40612152202ee8440f82a3d277008\20201028ans.xlsx')
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/1111/11/11/%E3%80%90%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E3%80%91%E5%BA%94%E7%94%A8%E7%AE%80%E4%BE%8B%20%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97-%E5%B0%8F%E7%99%BD%E6%97%A0%E8%84%91%E4%B9%B1%E7%94%A8/" data-id="cl50x8cna003occj3ed4o6p7n" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OldBlog-Before20220505/" rel="tag">OldBlog(Before20220505)</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97/" rel="tag">随机森林</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-【树形dp练习】洛谷 P2014选课 P1352没有上司的舞会P2016战略游戏" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/1111/11/11/%E3%80%90%E6%A0%91%E5%BD%A2dp%E7%BB%83%E4%B9%A0%E3%80%91%E6%B4%9B%E8%B0%B7%20P2014%E9%80%89%E8%AF%BE%20P1352%E6%B2%A1%E6%9C%89%E4%B8%8A%E5%8F%B8%E7%9A%84%E8%88%9E%E4%BC%9AP2016%E6%88%98%E7%95%A5%E6%B8%B8%E6%88%8F/" class="article-date">
  <time class="post-time" datetime="1111-11-11T03:06:11.000Z" itemprop="datePublished">
    <span class="post-month">11月</span><br/>
    <span class="post-day">11</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/1111/11/11/%E3%80%90%E6%A0%91%E5%BD%A2dp%E7%BB%83%E4%B9%A0%E3%80%91%E6%B4%9B%E8%B0%B7%20P2014%E9%80%89%E8%AF%BE%20P1352%E6%B2%A1%E6%9C%89%E4%B8%8A%E5%8F%B8%E7%9A%84%E8%88%9E%E4%BC%9AP2016%E6%88%98%E7%95%A5%E6%B8%B8%E6%88%8F/">【树形dp练习】洛谷 P2014选课 P1352没有上司的舞会P2016战略游戏.md</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a>,<a class="article-category-link" href="/categories/%E7%AE%97%E6%B3%95/DP/">DP</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="说明-2022-05-05"><a class="markdownIt-Anchor" href="#说明-2022-05-05"></a> 说明 - 2022-05-05</h2>
<p>本篇博客为本人原创, 原发布于CSDN, 在搭建个人博客后使用爬虫批量爬取并挂到个人博客, 出于一些技术原因博客未能完全还原到初始版本(而且我懒得修改), 在观看体验上会有一些瑕疵 ,若有需求会发布重制版总结性新博客。发布时间统一定为1111年11月11日。钦此。</p>
<h2 id="洛谷-p2014选课"><a class="markdownIt-Anchor" href="#洛谷-p2014选课"></a> 洛谷 P2014选课</h2>
<p>​<br>
#include <iostream><br>
#include <cstdio><br>
#include <algorithm><br>
#include <cstdlib><br>
#include <cstring><br>
#include <cmath><br>
#include <queue><br>
#include <vector><br>
#include <stack><br>
#include <map><br>
typedef long long LL;<br>
const int N = 305;<br>
int dp[N][N],score[N];<br>
std::vector<int>son[N];<br>
int n,m,f,g;</int></map></stack></vector></queue></cmath></cstring></cstdlib></algorithm></cstdio></iostream></p>
<pre><code>void dfs(int rt)
&#123;
   dp[rt][1] = score[rt];
   dp[rt][0] = 1;
   for(int i=0; i&lt;son[rt].size(); i++)&#123;
      int lt = son[rt][i];
      dfs(lt);
      dp[rt][0] += dp[lt][0];
   &#125;
   int lim = std::min(dp[rt][0],m+1);
   for(int i=0; i&lt;son[rt].size(); i++)&#123;
      int lt = son[rt][i];
      int limk = std::min(dp[lt][0],m+1);
      for(int j=lim; j&gt;=2; j--)&#123;
         for(int k=1; k&lt;=limk; k++)&#123;
            if(j-k &lt;1) break;
            dp[rt][j] = std::max(dp[rt][j],dp[rt][j-k]+dp[lt][k]);
         &#125;
      &#125;
   &#125;
&#125;
</code></pre>
<p>​<br>
int main()<br>
{<br>
memset(dp,0,sizeof(dp));<br>
scanf(&quot;%d%d&quot;,&amp;n,&amp;m);<br>
for(int i=1; i&lt;=n; i++){<br>
scanf(&quot;%d%d&quot;,&amp;f,&amp;g);<br>
son[f].push_back(i);<br>
score[i] = g;<br>
}<br>
score[0] = 0;<br>
dfs(0);<br>
std::cout &lt;&lt; dp[0][m+1] &lt;&lt; std::endl;<br>
return 0;<br>
}</p>
<p>​<br>
​</p>
<p>二刷改良</p>
<p>​<br>
#include <iostream><br>
#include <cstdio><br>
#include <cstring><br>
#include <cstdlib><br>
#include <algorithm><br>
#include <cmath><br>
#include <queue><br>
#include <map><br>
#include <stack><br>
#include <set><br>
#include <vector><br>
const int N = 305;</vector></set></stack></map></queue></cmath></algorithm></cstdlib></cstring></cstdio></iostream></p>
<p>​<br>
std::vector<int> son[N];</int></p>
<pre><code>int dp[N][N];
int val[N];
int n,m,f,v;

void dfs(int x)
&#123;
   dp[x][0] = 1;
   dp[x][1] = val[x];
   for(int i=0; i&lt;son[x].size(); i++)&#123;
      int y = son[x][i];
      dfs(y);
      dp[x][0] += dp[y][0];
      for(int j=m+1; j&gt;=2; j--)&#123;
         int lim = std::min(dp[y][0],j);
         for(int k=1; k&lt;j; k++)&#123;
            dp[x][j] = std::max(dp[x][j],dp[x][j-k]+dp[y][k]);
         &#125;
      &#125;
   &#125;
&#125;

int main()
&#123;
   scanf(&quot;%d%d&quot;,&amp;n,&amp;m);
   val[0] = 0;
   for(int i=1; i&lt;=n; i++)&#123;
      scanf(&quot;%d%d&quot;,&amp;f,&amp;v);
      val[i] = v;
      son[f].push_back(i);
   &#125;
   dfs(0);
   printf(&quot;%d&quot;,dp[0][m+1]);
   return 0;
&#125;
</code></pre>
<p>​</p>
<h2 id="洛谷-p1352-没有上司的舞会"><a class="markdownIt-Anchor" href="#洛谷-p1352-没有上司的舞会"></a> 洛谷 P1352 没有上司的舞会</h2>
<p>​<br>
#include &lt;bits/stdc++.h&gt;<br>
typedef long long LL;</p>
<pre><code>const int N = 6e3+5;
std::vector&lt;int&gt; son[N];
int qu[N],has[N],dp[N][2];
int n,a,b,rt;

void dfs(int rt)
&#123;
   dp[rt][0] = 0;
   dp[rt][1] = qu[rt];
   for(int i=0; i&lt;son[rt].size(); i++)&#123;
      int lt = son[rt][i];
      dfs(lt);
      dp[rt][0] += std::max(dp[lt][0],dp[lt][1]);
      dp[rt][1] += dp[lt][0];
   &#125;
&#125;
</code></pre>
<p>​<br>
int main(){<br>
scanf(&quot;%d&quot;,&amp;n);<br>
for(int i=1; i&lt;=n; i++){<br>
scanf(&quot;%d&quot;,&amp;qu[i]);<br>
}<br>
for(int i=1; i&lt;n; i++){<br>
scanf(&quot;%d%d&quot;,&amp;a,&amp;b);<br>
has[a] = 1;<br>
son[b].push_back(a);<br>
}<br>
for(int i=1; i&lt;=n; i++){<br>
if(!has[i]){<br>
rt = i;<br>
break;<br>
}<br>
}<br>
dfs(rt);<br>
printf(&quot;%d&quot;,std::max(dp[rt][0],dp[rt][1]));<br>
return 0;<br>
}</p>
<p>​<br>
​</p>
<h2 id="洛谷-p2016-战略游戏"><a class="markdownIt-Anchor" href="#洛谷-p2016-战略游戏"></a> 洛谷 P2016 战略游戏</h2>
<p>​<br>
#include <cstdio><br>
#include <iostream><br>
#include <cstring><br>
#include <cstdlib><br>
#include <algorithm><br>
#include <vector><br>
typedef std::pair&lt;int ,int&gt; PP;<br>
const int N = 1502;<br>
std::vector<int> son[N];<br>
int n,k,u,v;<br>
int dp[N][2];<br>
void dfs(int x)<br>
{<br>
dp[x][0] = 0;<br>
dp[x][1] = 1;<br>
for(int i=0; i&lt;son[x].size(); i++){<br>
int y = son[x][i];<br>
dfs(y);<br>
dp[x][0] += dp[y][1];<br>
dp[x][1] += std::min(dp[y][1],dp[y][0]);<br>
}<br>
}</int></vector></algorithm></cstdlib></cstring></iostream></cstdio></p>
<pre><code>int main()
&#123;

   scanf(&quot;%d&quot;,&amp;n);
   for(int i=0; i&lt;n; i++)&#123;
      scanf(&quot;%d%d&quot;,&amp;u,&amp;k);
      for(int j=0; j&lt;k; j++)&#123;
         scanf(&quot;%d&quot;,&amp;v);
         son[u].push_back(v);
      &#125;
   &#125;
   dfs(0);
   printf(&quot;%d&quot;,std::min(dp[0][0],dp[0][1]));

   return 0;
&#125;
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/1111/11/11/%E3%80%90%E6%A0%91%E5%BD%A2dp%E7%BB%83%E4%B9%A0%E3%80%91%E6%B4%9B%E8%B0%B7%20P2014%E9%80%89%E8%AF%BE%20P1352%E6%B2%A1%E6%9C%89%E4%B8%8A%E5%8F%B8%E7%9A%84%E8%88%9E%E4%BC%9AP2016%E6%88%98%E7%95%A5%E6%B8%B8%E6%88%8F/" data-id="cl50x8cnb003qccj3gx83caeq" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DP/" rel="tag">DP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OldBlog-Before20220505/" rel="tag">OldBlog(Before20220505)</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-【树状数组练习】洛谷 树状数组模板1、2 P1908 逆序对" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/1111/11/11/%E3%80%90%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%E7%BB%83%E4%B9%A0%E3%80%91%E6%B4%9B%E8%B0%B7%20%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%E6%A8%A1%E6%9D%BF1%E3%80%812%20P1908%20%E9%80%86%E5%BA%8F%E5%AF%B9/" class="article-date">
  <time class="post-time" datetime="1111-11-11T03:06:11.000Z" itemprop="datePublished">
    <span class="post-month">11月</span><br/>
    <span class="post-day">11</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/1111/11/11/%E3%80%90%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%E7%BB%83%E4%B9%A0%E3%80%91%E6%B4%9B%E8%B0%B7%20%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%E6%A8%A1%E6%9D%BF1%E3%80%812%20P1908%20%E9%80%86%E5%BA%8F%E5%AF%B9/">【树状数组练习】洛谷 树状数组模板1、2 P1908 逆序对.md</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a>,<a class="article-category-link" href="/categories/%E7%AE%97%E6%B3%95/%E6%80%9D%E6%83%B3or%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">思想or数据结构</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="说明-2022-05-05"><a class="markdownIt-Anchor" href="#说明-2022-05-05"></a> 说明 - 2022-05-05</h2>
<p>本篇博客为本人原创, 原发布于CSDN, 在搭建个人博客后使用爬虫批量爬取并挂到个人博客, 出于一些技术原因博客未能完全还原到初始版本(而且我懒得修改), 在观看体验上会有一些瑕疵 ,若有需求会发布重制版总结性新博客。发布时间统一定为1111年11月11日。钦此。</p>
<h2 id="洛谷-p3374-树状数组模板1"><a class="markdownIt-Anchor" href="#洛谷-p3374-树状数组模板1"></a> 洛谷 P3374 树状数组模板1</h2>
<p>​<br>
#include <cstdio><br>
#include <iostream><br>
#include <cstring><br>
#include <cstdlib><br>
#include <algorithm><br>
#include <vector><br>
#include <map><br>
#include <string><br>
//typedef long long int LL;<br>
typedef std::pair&lt;std::string ,char&gt; PP;<br>
const int N = 5e5+5;<br>
int tree[N];<br>
int n,m,vv,op,a,b;</string></map></vector></algorithm></cstdlib></cstring></iostream></cstdio></p>
<pre><code>void add(int i,int v)
&#123;
   while(i&lt;=n)&#123;
      tree[i] += v;
      i += i&amp;(-i);
   &#125;
&#125;

int query(int i)
&#123;
   int re = 0;
   while(i&gt;=1)&#123;
      re += tree[i];
      i -= i&amp;(-i);
   &#125;
   return re;
&#125;

int main()
&#123;
   scanf(&quot;%d%d&quot;,&amp;n,&amp;m);
   for(int i=1; i&lt;=n; i++)&#123;
      scanf(&quot;%d&quot;,&amp;vv);
      add(i,vv);
   &#125;
   for(int i=0; i&lt;m; i++)&#123;
      scanf(&quot;%d%d%d&quot;,&amp;op,&amp;a,&amp;b);
      if(op == 1)&#123;
         add(a,b);
      &#125;
      else&#123;
         printf(&quot;%d\n&quot;,query(b)-query(a-1));
      &#125;
   &#125;
   return 0;
&#125;
</code></pre>
<p>​</p>
<h2 id="洛谷-p3368树状数组模板2"><a class="markdownIt-Anchor" href="#洛谷-p3368树状数组模板2"></a> 洛谷 P3368树状数组模板2</h2>
<p>在区间中求某一单点的树状数组。初始化树状数组时，增加的值为&quot;此点比上一个点大多少&quot;</p>
<p>​<br>
#include <cstdio><br>
#include <iostream><br>
#include <cstring><br>
#include <cstdlib><br>
#include <algorithm><br>
#include <vector><br>
#include <map><br>
#include <string><br>
typedef long long int LL;<br>
//typedef std::pair&lt;std::string ,char&gt; PP;<br>
const int N = 5e5+5;<br>
LL tree[N];<br>
int n,m,op,a,b;<br>
LL c,vv,ls;</string></map></vector></algorithm></cstdlib></cstring></iostream></cstdio></p>
<pre><code>void add(int i,LL v)
&#123;
   while(i&lt;=n)&#123;
      tree[i] += v;
      i += i&amp;(-i);
   &#125;
&#125;

LL query(int i)
&#123;
   LL re = 0;
   while(i&gt;=1)&#123;
      re += tree[i];
      i -= i&amp;(-i);
   &#125;
   return re;
&#125;

int main()
&#123;
   scanf(&quot;%d%d&quot;,&amp;n,&amp;m);
   ls = 0;
   for(int i=1; i&lt;=n; i++)&#123;
      scanf(&quot;%lld&quot;,&amp;vv);
      add(i,vv-ls);
      ls = vv;
   &#125;
   for(int i=0; i&lt;m; i++)&#123;
      scanf(&quot;%d&quot;,&amp;op);
      if(op == 1)&#123;
         scanf(&quot;%d%d%lld&quot;,&amp;a,&amp;b,&amp;c);
         add(a,c);
         add(b+1,-c);
      &#125;
      else&#123;
         scanf(&quot;%d&quot;,&amp;a);
         printf(&quot;%lld\n&quot;,query(a));
      &#125;

   &#125;
   return 0;
&#125;
</code></pre>
<p>​</p>
<h2 id="洛谷-p1908-逆序对"><a class="markdownIt-Anchor" href="#洛谷-p1908-逆序对"></a> 洛谷 P1908 逆序对</h2>
<p>数据大小的范围是1e9，但是我们只需要知道他们的大小关系，所以可以压成5e5做</p>
<p>​<br>
#include <cstdio><br>
#include <iostream><br>
#include <cstring><br>
#include <cstdlib><br>
#include <algorithm><br>
#include <vector><br>
#include <map><br>
#include <set><br>
typedef long long int LL;<br>
//typedef std::pair&lt;int ,int&gt; PP;<br>
const int N = 5e5+5;<br>
int tree[N],ord[N];<br>
struct AA<br>
{<br>
int val,n;<br>
}qu[N];<br>
int n,v,idx;<br>
LL ans;</set></map></vector></algorithm></cstdlib></cstring></iostream></cstdio></p>
<pre><code>void add(int i,int x)
&#123;
   while(i&lt;=n)&#123;
      tree[i] += x;
      i += i&amp;(-i);
   &#125;
&#125;

LL qry(int i)
&#123;
   LL re = 0;
   while(i&gt;0)&#123;
      re += tree[i];
      i -= i&amp;(-i);
   &#125;
   return re;
&#125;

bool cmp(AA x , AA y)
&#123;
   if(x.val == y.val) return x.n&lt;y.n;
   return x.val &lt; y.val;
&#125;

int main()
&#123;
   //freopen(&quot;D:\\EdgeDownloadPlace\\P1908_11.in&quot;,&quot;r&quot;,stdin);
   ans = 0;
   scanf(&quot;%d&quot;,&amp;n);
   for(int i=1; i&lt;=n; i++)&#123;
      scanf(&quot;%d&quot;,&amp;qu[i].val);
      qu[i].n = i;
   &#125;
   std::sort(qu+1,qu+n+1,cmp);
   for(int i=1; i&lt;=n; i++)&#123;
      ord[qu[i].n] = i;
   &#125;
   for(int i=1; i&lt;=n; i++)&#123;
      add(ord[i],1);
      ans += i-qry(ord[i]);
   &#125;
   printf(&quot;%lld\n&quot;,ans);

   return 0;
&#125;
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/1111/11/11/%E3%80%90%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%E7%BB%83%E4%B9%A0%E3%80%91%E6%B4%9B%E8%B0%B7%20%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%E6%A8%A1%E6%9D%BF1%E3%80%812%20P1908%20%E9%80%86%E5%BA%8F%E5%AF%B9/" data-id="cl50x8cnd003uccj33n756cra" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OldBlog-Before20220505/" rel="tag">OldBlog(Before20220505)</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/" rel="tag">树状数组</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-【树的直径 dfs dp】P4408 [NOI2003] 逃学的小孩" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/1111/11/11/%E3%80%90%E6%A0%91%E7%9A%84%E7%9B%B4%E5%BE%84%20dfs%20dp%E3%80%91P4408%20%5BNOI2003%5D%20%E9%80%83%E5%AD%A6%E7%9A%84%E5%B0%8F%E5%AD%A9/" class="article-date">
  <time class="post-time" datetime="1111-11-11T03:06:11.000Z" itemprop="datePublished">
    <span class="post-month">11月</span><br/>
    <span class="post-day">11</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/1111/11/11/%E3%80%90%E6%A0%91%E7%9A%84%E7%9B%B4%E5%BE%84%20dfs%20dp%E3%80%91P4408%20%5BNOI2003%5D%20%E9%80%83%E5%AD%A6%E7%9A%84%E5%B0%8F%E5%AD%A9/">【树的直径 dfs dp】P4408 [NOI2003] 逃学的小孩.md</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a>,<a class="article-category-link" href="/categories/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/">图论</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="说明-2022-05-05"><a class="markdownIt-Anchor" href="#说明-2022-05-05"></a> 说明 - 2022-05-05</h2>
<p>本篇博客为本人原创, 原发布于CSDN, 在搭建个人博客后使用爬虫批量爬取并挂到个人博客, 出于一些技术原因博客未能完全还原到初始版本(而且我懒得修改), 在观看体验上会有一些瑕疵 ,若有需求会发布重制版总结性新博客。发布时间统一定为1111年11月11日。钦此。</p>
<h2 id="p4408-noi2003-逃学的小孩"><a class="markdownIt-Anchor" href="#p4408-noi2003-逃学的小孩"></a> P4408 [NOI2003] 逃学的小孩</h2>
<p>​<br>
#include <iostream><br>
#include <cstdio><br>
#include <cstdlib><br>
#include <cstring><br>
#include <cmath><br>
#include <algorithm><br>
#include <string><br>
#include <queue><br>
#include <vector><br>
#include <stack><br>
#include <map><br>
#include <set><br>
typedef long long int LL;<br>
const int N = 2e5+5, M = -1, INF = 0x7fffffff;<br>
int n,m,u,v,pid,tid;<br>
LL w,plong,tlong;<br>
int idx;<br>
int head[N];<br>
LL disa[N],disb[N];<br>
struct Edge<br>
{<br>
int to,nxt;<br>
LL w;<br>
}edg[N&lt;&lt;1];<br>
void addEdge(int fr,int to,LL w)<br>
{<br>
edg[idx].to = to;<br>
edg[idx].nxt = head[fr];<br>
edg[idx].w = w;<br>
head[fr] = idx++;<br>
}<br>
void initial()<br>
{<br>
idx = 2;<br>
}<br>
void dfs(LL leng,int id,int efrom)<br>
{<br>
if(leng &gt; plong){<br>
plong = leng;<br>
pid = id;<br>
}<br>
for(int e=head[id]; e; e=edg[e].nxt){<br>
if((e^1) == efrom) continue;<br>
dfs(leng+edg[e].w,edg[e].to,e);<br>
}<br>
}<br>
void DFS(LL dis[],int x,int efrom,LL leng)<br>
{<br>
dis[x] = leng;<br>
for(int e=head[x]; e; e=edg[e].nxt){<br>
if((e^1) == efrom) continue;<br>
int y = edg[e].to;<br>
DFS(dis,y,e,leng+edg[e].w);<br>
}<br>
}<br>
int main()<br>
{<br>
initial();<br>
scanf(&quot;%d%d&quot;,&amp;n,&amp;m);<br>
for(int i=0; i&lt;m; i++) {<br>
scanf(&quot;%d%d%lld&quot;,&amp;u,&amp;v,&amp;w);<br>
addEdge(u,v,w);<br>
addEdge(v,u,w);<br>
}<br>
pid = 1, plong = 0;<br>
dfs(0,pid,0);<br>
tid = pid;<br>
pid = tid, plong = 0;<br>
dfs(0,pid,0);<br>
DFS(disa,tid,0,0);<br>
DFS(disb,pid,0,0);<br>
tlong = 0;<br>
for(int i=1; i&lt;=n; i++){<br>
tlong = std::max(tlong,std::min(disa[i],disb[i]));<br>
}<br>
printf(&quot;%lld&quot;,tlong+plong);<br>
return 0;<br>
}</set></map></stack></vector></queue></string></algorithm></cmath></cstring></cstdlib></cstdio></iostream></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/1111/11/11/%E3%80%90%E6%A0%91%E7%9A%84%E7%9B%B4%E5%BE%84%20dfs%20dp%E3%80%91P4408%20[NOI2003]%20%E9%80%83%E5%AD%A6%E7%9A%84%E5%B0%8F%E5%AD%A9/" data-id="cl50x8cne003wccj31p7r9qi3" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DFS/" rel="tag">DFS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DP/" rel="tag">DP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OldBlog-Before20220505/" rel="tag">OldBlog(Before20220505)</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-【树的直径】树形DP求解" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/1111/11/11/%E3%80%90%E6%A0%91%E7%9A%84%E7%9B%B4%E5%BE%84%E3%80%91%E6%A0%91%E5%BD%A2DP%E6%B1%82%E8%A7%A3/" class="article-date">
  <time class="post-time" datetime="1111-11-11T03:06:11.000Z" itemprop="datePublished">
    <span class="post-month">11月</span><br/>
    <span class="post-day">11</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/1111/11/11/%E3%80%90%E6%A0%91%E7%9A%84%E7%9B%B4%E5%BE%84%E3%80%91%E6%A0%91%E5%BD%A2DP%E6%B1%82%E8%A7%A3/">【树的直径】树形DP求解.md</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a>,<a class="article-category-link" href="/categories/%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/">图论</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="说明-2022-05-05"><a class="markdownIt-Anchor" href="#说明-2022-05-05"></a> 说明 - 2022-05-05</h2>
<p>本篇博客为本人原创, 原发布于CSDN, 在搭建个人博客后使用爬虫批量爬取并挂到个人博客, 出于一些技术原因博客未能完全还原到初始版本(而且我懒得修改), 在观看体验上会有一些瑕疵 ,若有需求会发布重制版总结性新博客。发布时间统一定为1111年11月11日。钦此。</p>
<h2 id="思路"><a class="markdownIt-Anchor" href="#思路"></a> 思路</h2>
<p>每次记录每个子树从根到叶的最长的链， 然后把最长前2长的拼起来<br>
先更新D再更新dp， 否则会求出一条最长链*2</p>
<p>​<br>
void dfs(int x, int efr){<br>
for(int e = head[x]; e; e = edg[e].nxt){<br>
if((e ^ 1) == efr) continue;<br>
int y = edg[e].to;<br>
dfs(y, e);<br>
D = std::max(D, dp[x] + dp[y] + 1);<br>
dp[x] = std::max(dp[x], dp[y] + 1);<br>
}<br>
}</p>
<h2 id="hdu-6201-transaction-transaction-transaction非模题"><a class="markdownIt-Anchor" href="#hdu-6201-transaction-transaction-transaction非模题"></a> HDU 6201 transaction transaction transaction（非模题）</h2>
<p>​<br>
#include &lt;bits/stdc++.h&gt;<br>
const int N = 1e5 + 4;<br>
int val[N], dp[N][2], head[N];<br>
struct Edge{<br>
int to, nxt, va;<br>
}edg[N &lt;&lt; 1];<br>
int idx, n, t, u, v, w, ans;<br>
void addE(int fr, int to , int w){<br>
edg[idx].to = to;<br>
edg[idx].nxt = head[fr];<br>
edg[idx].va = w;<br>
head[fr] = idx <ins>;<br>
}<br>
void dfs(int x, int efr){<br>
dp[x][0] = val[x], dp[x][1] = -val[x];<br>
for(int e=head[x]; e; e=edg[e].nxt){<br>
if((e ^ 1) == efr) continue;<br>
int y = edg[e].to;<br>
dfs(y, e);<br>
dp[x][0] = std::min(dp[x][0], dp[y][0] + edg[e].va);<br>
dp[x][1] = std::min(dp[x][1], dp[y][1] + edg[e].va);<br>
}<br>
ans = std::min(ans, dp[x][0] + dp[x][1]);<br>
}<br>
int main(){<br>
scanf(&quot;%d&quot;, &amp;t);<br>
while(t --){<br>
scanf(&quot;%d&quot;, &amp;n);<br>
idx = 2, ans = 0;<br>
for(int i=0; i&lt;=n; i</ins>) head[i] = 0;<br>
for(int i=1; i&lt;=n; i++) scanf(&quot;%d&quot;, &amp;val[i]);<br>
for(int i=1; i&lt;n; i++){<br>
scanf(&quot;%d%d%d&quot;, &amp;u, &amp;v, &amp;w);<br>
addE(u, v, w), addE(v, u, w);<br>
}<br>
dfs(1, -1);<br>
printf(&quot;%d\n&quot;, -ans);<br>
}<br>
return 0;<br>
}</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/1111/11/11/%E3%80%90%E6%A0%91%E7%9A%84%E7%9B%B4%E5%BE%84%E3%80%91%E6%A0%91%E5%BD%A2DP%E6%B1%82%E8%A7%A3/" data-id="cl50x8cnf0040ccj3cvdd3u66" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DP/" rel="tag">DP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OldBlog-Before20220505/" rel="tag">OldBlog(Before20220505)</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-【爬虫】 爬取云班课上老师发的视频资源 python" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/1111/11/11/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91%20%E7%88%AC%E5%8F%96%E4%BA%91%E7%8F%AD%E8%AF%BE%E4%B8%8A%E8%80%81%E5%B8%88%E5%8F%91%E7%9A%84%E8%A7%86%E9%A2%91%E8%B5%84%E6%BA%90%20python/" class="article-date">
  <time class="post-time" datetime="1111-11-11T03:06:11.000Z" itemprop="datePublished">
    <span class="post-month">11月</span><br/>
    <span class="post-day">11</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/1111/11/11/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91%20%E7%88%AC%E5%8F%96%E4%BA%91%E7%8F%AD%E8%AF%BE%E4%B8%8A%E8%80%81%E5%B8%88%E5%8F%91%E7%9A%84%E8%A7%86%E9%A2%91%E8%B5%84%E6%BA%90%20python/">【爬虫】 爬取云班课上老师发的视频资源 python.md</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%99%E7%BB%83%E6%88%91%E6%83%B3%E5%AD%A6%E6%8C%82%E8%BE%B9%E8%BA%B2%E7%89%9B/">教练我想学挂边躲牛</a>,<a class="article-category-link" href="/categories/%E6%95%99%E7%BB%83%E6%88%91%E6%83%B3%E5%AD%A6%E6%8C%82%E8%BE%B9%E8%BA%B2%E7%89%9B/%E7%88%AC%E8%99%AB/">爬虫</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="说明-2022-05-05"><a class="markdownIt-Anchor" href="#说明-2022-05-05"></a> 说明 - 2022-05-05</h2>
<p>本篇博客为本人原创, 原发布于CSDN, 在搭建个人博客后使用爬虫批量爬取并挂到个人博客, 出于一些技术原因博客未能完全还原到初始版本(而且我懒得修改), 在观看体验上会有一些瑕疵 ,若有需求会发布重制版总结性新博客。发布时间统一定为1111年11月11日。钦此。</p>
<h2 id="蒟蒻声明"><a class="markdownIt-Anchor" href="#蒟蒻声明"></a> 蒟蒻声明</h2>
<p>这个程序虽然可以差强人意地实现功能但是烂的一批，也不打算做出较大改动了。后面会总结一些不足之处，以警示以后。</p>
<h2 id="思路"><a class="markdownIt-Anchor" href="#思路"></a> 思路</h2>
<p>。<br>
1.<br>
通过抓包发现云班课的视频时m3u8的，即一个m3u8的文件中记录了数个ts类型视频的链接，这些ts视频的时常一般为10秒。想爬取某个视频只需要获取视频对应的m3u8文件，依次把m3u8文件中的ts文件下载并通过os.system()调用命令行把一系列的ts文件合并为mp4<br>
2.<br>
步骤1是单独下载一个视频的思路，若想下载所有视频，只需要找出所有视频的m3u8，重复步骤1。</p>
<h2 id="单独下载一个m3u8"><a class="markdownIt-Anchor" href="#单独下载一个m3u8"></a> 单独下载一个m3u8</h2>
<p>笔者仅仅在要爬的课程中实验该程序可以达到目的，至于其他的m3u8就不清楚了<br>
1.<br>
获取m3u8文件后解析其内容，做到可以提取出所有的ts文件链接<br>
2.<br>
把所有的ts文件下载本地的同一个文件夹中<br>
3.<br>
调用命令行，例如这样：<br>
os.system(‘copy /b ‘+os.path.abspath(tempworkpath)+’\ _.ts<br>
‘+os.path.abspath(pathOUTPUT)+’\’+nameOUTPUT+’.mp4’)<br>
合并所有ts文件为一个新的mp4文件<br>
4.<br>
把这一次下载的ts文件删掉，以备下一次操作<br>
os.system('del ‘+os.path.abspath(tempworkpath)+’_.ts’)</p>
<pre><code>import re
import requests
from bs4 import BeautifulSoup
import os


def DownOne(url,name):
    toIdxStr = lambda x : ('000000000'+str(x))[-10:]

    urlM3U8 = url
    nameOUTPUT = name.replace(' ','')
    pathOUTPUT = 'out'
    sch = re.search('(.+?/[0-9].&#123;3&#125;/[0-9].&#123;1&#125;/[0-9].&#123;1&#125;/)(.+?).m3u8',urlM3U8)
    headM3U8 = sch.group(1)
    nameM3U8 =sch.group(2)
    tempworkpath = 'aaabbbcccdddeeefffggghhhiii'
    
    resM3U8 = requests.get(urlM3U8)
    
    lstTS = re.findall('.+?ts',resM3U8.text)
    
    if not os.path.exists(tempworkpath):
        os.mkdir(tempworkpath)
    if not os.path.exists(pathOUTPUT):
        os.mkdir(pathOUTPUT)
    
    for i,each in enumerate(lstTS):
        print(i,'of',len(lstTS))
        res = requests.get(headM3U8+each)
        with open(tempworkpath+'/'+nameM3U8+toIdxStr(i)+'.ts', 'wb') as f:
            f.write(res.content)
    
    print('合并')
    print('copy /b '+os.path.abspath(tempworkpath)+'\\*.ts '+os.path.abspath(pathOUTPUT)+'\\'+nameOUTPUT+'.mp4')
    os.system('copy /b '+os.path.abspath(tempworkpath)+'\\*.ts '+os.path.abspath(pathOUTPUT)+'\\'+nameOUTPUT+'.mp4')
    os.system('del '+os.path.abspath(tempworkpath)+'\\*.ts')

if __name__ == '__main__':
    url = input('m3u8 url:')
    name = input('video name:')
    DownOne(url,name)
</code></pre>
<h2 id="爬取全部的视频资源"><a class="markdownIt-Anchor" href="#爬取全部的视频资源"></a> 爬取全部的视频资源</h2>
<p>下方代码中的import DownloaderM3U8 as DOWN，这个库是上面爬一个m3u8的那一坨<br>
下面的程序这些部分我改了，爬的话要填自己的账号密码等</p>
<blockquote>
<p>logData = { ‘account_name’ : ‘这里是我的账号’<br>
,‘user_pwd’ : ‘这里是我的密码’<br>
,‘remember_me’ : ‘N’<br>
}<br>
targetURL = ‘填需要获取资源的页面（云班课进入一个课程，再点资源，然后把链接复制过来）’<br>
user-agent也改了，不太清楚这个是不是必要的</p>
</blockquote>
<h4 id="html解析思路"><a class="markdownIt-Anchor" href="#html解析思路"></a> html解析思路</h4>
<p>这是云班课储存资源的思路</p>
<p>​<br>
​    &lt;div1 这是包含所有视频的一块&gt;<br>
​    	&lt;div2 第一单元的所有视频&gt;  所有的div2的集合对应程序里的d2<br>
​    		&lt;div 视频&gt;	 一个div2中所有div的集合对应程序里的d3<br>
​    		&lt;div 视频&gt;<br>
​    		&lt;div 视频&gt;<br>
​    		&lt;div 视频&gt;<br>
​    		&lt;div 视频&gt;<br>
​    	<br>
​    	&lt;div2 第二单元的所有视频&gt;<br>
​    		&lt;div 视频&gt;<br>
​    		&lt;div 视频&gt;<br>
​    		&lt;div 视频&gt;<br>
​    		&lt;div 视频&gt;<br>
​    		&lt;div 视频&gt;<br>
​    	<br>
​    	&lt;div2 第三单元的所有视频&gt;<br>
​    		&lt;div 视频&gt;<br>
​    		&lt;div 视频&gt;<br>
​    		&lt;div 视频&gt;<br>
​    		&lt;div 视频&gt;<br>
​    		&lt;div 视频&gt;<br>
​    	<br>
​    </p>
<p>。</p>
<p>值得一提的是我没有在网页的html中找到m3u8的链接，但是每个视频有一张图片，图片的链接和视频的m3u8链接有许多相同点。<br>
其中图片的链接中有形如： <strong>'年份/月份/字符串’ <strong>的格式，而m3u8的链接中有形如：</strong> ‘年份/月份/日期/字符串’</strong><br>
的格式，并且这两段格式中除了图片链接没有日期外，其他完全相同</p>
<p>​<br>
​    #云班课视频资源获取 开始于2021/03/12<br>
​    ‘’’<br>
​    目前没有任何try,纯莽<br>
​<br>
part1 登录 (成功)<br>
part2 找到所有视频块div(成功)<br>
part3 获取所有视频对应的m3u8链接(遇到问题)<br>
问题：<br>
html中没有找到对应的m3u8链接,但有一张图片的链接,其中有 #年份/月份/字符串# 的部分与我们需要的m3u8链接十分相似<br>
需要的m3u8链接的该部分格式为 #年份/月份/日期/字符串# 所以尝试枚举已知月份中所有的日期暴力破解<br>
事实证明这种方法有概率失败,因为有的m3u8链接会与图片连接中的月份有偏差,不保证能完全获取所有的m3u8链接<br>
可能的解决方案：<br>
1.尝试枚举一年中的所有日期而不是这个月的(需要时间长,但不失为一种方法,尚未尝试),<br>
但不排除m3u8链接和img链接的年份也有偏差的可能<br>
//-----------------------------------------------------------<br>
2021/03/12:<br>
若没有找到正确的m3u8链接,则尝试读取下一个月的所有日期<br>
这样可以正确解析出更多的链接,但是仍然不能完全解决问题<br>
//-----------------------------------------------------------</p>
<pre><code>part4 针对每一个m3u8链接下载其中的所有js链接,并尝试调用命令行指令合并ts文件为mp4(尚未开始,太懒了)
    这一步脱离前三个part,独立进行
'''

import re
import requests
from bs4 import BeautifulSoup
import DownloaderM3U8 as DOWN

def monthIter(year,month):
    monthMap = &#123; 1:  31 
                ,2:  28
                ,3:  31 
                ,4:  30
                ,5:  31
                ,6:  30
                ,7:  31
                ,8:  31
                ,9:  30
                ,10: 31
                ,11: 30
                ,12: 31
    &#125;
    if month == 2:
        if year%400 == 0 or (year%4 == 0 and year%100 != 0):
            monthMap[2] += 1
    return range(1,monthMap[month]+1)
</code></pre>
<p>​<br>
​    def toLinkStr(ss):<br>
​        ss = str(ss)<br>
​        return ‘0’+ss if len(ss) == 1 else ss</p>
<p>​<br>
​    m3u8Head = ‘<a target="_blank" rel="noopener" href="https://video-cdn-2.mosoteach.cn/mssvc/file">https://video-cdn-2.mosoteach.cn/mssvc/file</a>’<br>
​    m3u8Tail = ‘m3u8’<br>
​<br>
logURL = r’<a target="_blank" rel="noopener" href="https://www.mosoteach.cn/web/index.php?c=passport&amp;m=account_login">https://www.mosoteach.cn/web/index.php?c=passport&amp;m=account_login</a>’</p>
<pre><code>session = requests.session()

logHeader = &#123; 'Referer'      : 'https://www.mosoteach.cn/web/index.php?c=passport'
             ,'User-Agent'   : '填自己的，好像不填也行，不太清楚'
&#125;
logData = &#123;  'account_name' : '这里是我的账号'
            ,'user_pwd'     : '这里是我的密码'
            ,'remember_me'  : 'N'
&#125; 

logRES = session.post(logURL ,headers = logHeader, data = logData)

targetURL = '填需要获取资源的页面（云班课进入一个课程，再点资源，然后把链接复制过来）'

res = session.get(targetURL)
soup = BeautifulSoup(res.text,features='lxml')
d1 = soup.find('div', id = 'res-list-box')
d2 = d1.find_all('div',class_ = 'hide-div')

namelst = []
lst = []
cnt = 0
jumplst = []
for i,one in enumerate(d2):
    #print('[第',i,'块]')
    d3 = one.find_all('div',class_ = 'res-row-open-enable res-row preview')
    for j,each in enumerate(d3):
        #print(' 第',j,'个',end = ' ')
        ss = each.find('img', class_ = 'res-icon')['src']
        linkKey = re.search('capture/([0-9].&#123;3&#125;)/([0-9].&#123;1&#125;)(.+?)jpg?',ss)
        m3u8Middle = m3u8Head + '/' + linkKey.group(1) + '/' + linkKey.group(2) + '/&#123;day&#125;' + linkKey.group(3) + m3u8Tail
        m3u8MiddlePLUS = m3u8Head + '/' + linkKey.group(1) + '/' + '&#123;mth&#125;' + '/&#123;day&#125;' + linkKey.group(3) + m3u8Tail
        cnt += 1 
        print(cnt)
        print(m3u8Middle)
        #'''
        found = False
        zyear  = int(linkKey.group(1))
        zmonth = int(linkKey.group(2))
        for EE in monthIter(zyear,zmonth):
            m3u8Final = m3u8Middle.format(day = toLinkStr(EE))
            rr = requests.get(m3u8Final)
            if re.search('Error',rr.text) == None:
                lst.append(m3u8Final)
                namelst.append(each.find('span',class_ = 'res-name')['title'])
                print(m3u8Final)
                found = True
                break
        if found == False:
            zmonth += 1
            if zmonth &gt; 12:
                zmonth = 1
                zyear += 1
                m3u8Middle = m3u8MiddlePLUS
            for EE in monthIter(zyear,zmonth):
                m3u8Final = m3u8Middle.format(day = toLinkStr(EE), mth = toLinkStr(zmonth))
                rr = requests.get(m3u8Final)
                if re.search('Error',rr.text) == None:
                    lst.append(m3u8Final)
                    namelst.append(each.find('span',class_ = 'res-name')['title'])
                    print(m3u8Final)
                    found = True
                    break
        if found == False:
            print('##第',i,'块第',j,'个已被跳过')
            jumplst.append((i,j))
        print('---')
       # '''
            #print(each,end = ' ')
        #print(int(linkKey.group(1)),int(linkKey.group(2)))

print('共跳过个数:', len(jumplst), '\n分别为:')
for each in jumplst:
    print(each)

print('len(lst) == len(namelst) ?',len(lst),len(namelst))

print('开始抓取')
for i in range(len(lst)):
    print(namelst[i])
    DOWN.DownOne(lst[i],namelst[i])
</code></pre>
<p>​<br>
​    print(‘共跳过个数:’, len(jumplst), ‘\n分别为:’)<br>
​    for each in jumplst:<br>
​        print(each)</p>
<h2 id="不足-与-可以预期的改进已经不会去改了所以是可以预期的改进"><a class="markdownIt-Anchor" href="#不足-与-可以预期的改进已经不会去改了所以是可以预期的改进"></a> 不足 与 可以预期的改进（已经不会去改了，所以是可以预期的改进）</h2>
<h4 id="不足"><a class="markdownIt-Anchor" href="#不足"></a> 不足</h4>
<p>这个程序的思路是找到整个页面中所有的m3u8存入一个列表，然后遍历列表依次下载。这样时间非常长，如果中途出错还要从头开始重新来。<br>
。<br>
没有try，没有写try的意识，等着以后迎接暴毙吧</p>
<h4 id="可以预期的改进"><a class="markdownIt-Anchor" href="#可以预期的改进"></a> 可以预期的改进</h4>
<p>1.分块获取m3u8，先获取每一个大块，再在每一个大块中获得这一大块中所有视频的m3u8<br>
2.细化获取项，提供获取某一特定块中所有视频的选项<br>
3.细化获取项，提供在某一特定块中获取某一特定视频的选项<br>
4.做出图形界面，以一级二级标签分好大块和每个大块中的视频，可以阵对视频多选，阵对块多选，进行下载</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/1111/11/11/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91%20%E7%88%AC%E5%8F%96%E4%BA%91%E7%8F%AD%E8%AF%BE%E4%B8%8A%E8%80%81%E5%B8%88%E5%8F%91%E7%9A%84%E8%A7%86%E9%A2%91%E8%B5%84%E6%BA%90%20python/" data-id="cl50x8cng0042ccj3byiveox3" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OldBlog-Before20220505/" rel="tag">OldBlog(Before20220505)</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a></li></ul>

    </footer>
  </div>
  
</article>




  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/5/">&lt;&lt;&lt; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/7/">下一页 &gt;&gt;&gt;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">蓝湖畔淅淅沥沥的雨</h1>
    <h2 class="blog-subtitle">All tragedy erased, I see only wonders...</h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
          <a href="/bridges" title="Bridges">
            <li>传送门</li>
          </a>
        
          <a href="/knightabout" title="About">
            <li>关于</li>
          </a>
        
          <a href="/announcement" title="Announcement">
            <li>公告</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/images/avatar.png">
    <h2 class="author">StarsWhisper</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>79</strong><br>文章</div></a>
      <a href="/categories"><div><strong>32</strong><br>分类</div></a>
      <a href="/tags"><div><strong>63</strong><br>标签</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="https://github.com/Wldcmzy" target="_blank" title="Github">
          Github
        </a>
      
        <a class="hvr-bounce-in" href="https://blog.csdn.net/wldcmzy" target="_blank" title="CSDN">
          CSDN
        </a>
      
        <a class="hvr-bounce-in" href="https://space.bilibili.com/83743701" target="_blank" title="bilibili(无技术和学习内容)">
          bilibili(无技术和学习内容)
        </a>
      
    </div>

    <div class="friend-link">
      <h2>友情链接</h2>
      
        <a class="hvr-bounce-in" href="https://shanamaid.github.io/" target="_blank" title="夏娜主题作者的博客">
          夏娜主题作者的博客
        </a>
      
    </div>
  </div>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2021 - 2022 StarsWhisper<br>
      由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动 | 
      主题-<a target="_blank" rel="noopener" href="https://github.com/ShanaMaid/hexo-theme-shana">Shana</a>
	  (但是魔改)
      
    </div>
    
  </div>
</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  
<link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">

  
<script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>




  
<link rel="stylesheet" href="/plugin/galmenu/GalMenu.css">

  
<script src="/plugin/galmenu/GalMenu.js"></script>

  <div class="GalMenu GalDropDown">
      <div class="circle" id="gal">
        <div class="ring">
          
            <a href="/announcement" title="" class="menuItem">公告</a>
          
            <a href="/tags" title="" class="menuItem">标签</a>
          
            <a href="/categories" title="" class="menuItem">分类</a>
          
            <a href="/archives" title="" class="menuItem">归档</a>
          
            <a href="/knightabout" title="" class="menuItem">关于</a>
          
            <a href="/bridges" title="" class="menuItem">传送门</a>
          
        </div>
        
          <audio id="audio" src="#"></audio>
        
      </div> 
</div>
<div id="overlay" style="opacity: 1; cursor: pointer;"></div>
  <script type="text/javascript">var items = document.querySelectorAll('.menuItem');
    for (var i = 0,
    l = items.length; i < l; i++) {
      items[i].style.left = (50 - 35 * Math.cos( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%";
      items[i].style.top = (50 + 35 * Math.sin( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%"
    }</script>
<script type="text/javascript">
  $(document).ready(function() {
    $('body').GalMenu({
      'menu': 'GalDropDown'
    })
  });
</script>

  <section class="hidden-xs"> 
  <ul class="cb-slideshow"> 
    <li><span>苟利</span></li> 
    <li><span>国家</span></li> 
    <li><span>生死以</span></li> 
    <li><span>岂能</span></li> 
    <li><span>祸福</span></li> 
    <li><span>趋避之</span></li> 
  </ul>
</section>

<script src="/js/script.js"></script>




  </div>
</body>
</html>